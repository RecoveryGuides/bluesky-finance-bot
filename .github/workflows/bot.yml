name: üöÄ Finance Growth Bot

on:
  schedule:
    # USA prime time: 9 AM, 1 PM, 5 PM EST
    - cron: '0 14 * * *'  # 9 AM EST = 14:00 UTC
    - cron: '0 18 * * *'  # 1 PM EST = 18:00 UTC  
    - cron: '0 22 * * *'  # 5 PM EST = 22:00 UTC
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: üì• Pobierz kod
      uses: actions/checkout@v4
    
    - name: üêç Ustaw Pythona
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: üì¶ Zainstaluj atproto
      run: pip install atproto==0.0.48
    
    - name: ü§ñ Uruchom bota
      env:
        BLUESKY_HANDLE: ${{ secrets.BLUESKY_HANDLE }}
        BLUESKY_PASSWORD: ${{ secrets.BLUESKY_PASSWORD }}
      run: python finance_growth_bot.py
    
    - name: üìä Zapisz pliki
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: bot-files
        path: |
          bot_stats.json
          comments_history.json
        retention-days: 7
    
    - name: üìà Poka≈º podsumowanie
      if: always()
      run: |
        echo ""
        echo "========================================"
        echo "ü§ñ FINANCE BOT - PODSUMOWANIE"
        echo "========================================"
        echo ""
        
        # Sprawd≈∫ pliki
        if [ -f "bot_stats.json" ]; then
          echo "‚úÖ bot_stats.json istnieje"
          TOTAL_COMMENTS=$(grep -o '"total_comments":[0-9]*' bot_stats.json | grep -o '[0-9]*' || echo "0")
          SHOP_LINKS=$(grep -o '"shop_links_posted":[0-9]*' bot_stats.json | grep -o '[0-9]*' || echo "0")
          echo "üìä Komentarzy: $TOTAL_COMMENTS"
          echo "üîó Link√≥w do sklepu: $SHOP_LINKS"
        else
          echo "‚ùå bot_stats.json nie istnieje"
        fi
        
        if [ -f "comments_history.json" ]; then
          FILE_SIZE=$(wc -c < comments_history.json)
          echo "‚úÖ comments_history.json istnieje ($FILE_SIZE bajt√≥w)"
          LINE_COUNT=$(grep -c '"' comments_history.json 2>/dev/null || echo "0")
          echo "üí¨ Wpis√≥w w historii: $LINE_COUNT"
        else
          echo "‚ùå comments_history.json nie istnieje"
        fi
        
        echo ""
        echo "========================================"
        echo "üì• POBRANE PLIKI:"
        echo "1. Pobierz 'bot-files' z Artifacts"
        echo "2. Sprawd≈∫ konto Bluesky"
        echo "3. Monitoruj payhip.com/daveprime"
        echo ""
        echo "üîÑ NASTƒòPNY RAZ:"
        echo "9 AM, 1 PM, 5 PM EST"
        echo "========================================"
